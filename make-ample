

DRIVERS = apple1.cpp apple2.cpp apple3.cpp apple2e.cpp apple2gs.cpp agat.cpp vgmplay.cpp mac.cpp mac128.cpp
SOURCES = $(subst $(space),$(comma),$(addprefix src/mame/drivers/,$(DRIVERS)))
comma = ,
empty = 
space = $(empty) $(empty)

.PHONY: all
all: mame64 mame-data.tgz


mame-universal: mame-arm64 mame-x64
	lipo -create -output mame-universal mame-arm64 mame-x64

mame-arm64:
	make -j3 REGENIE=${REGENIE} SOURCES=${SOURCES} SDL_INI_PATH=. USE_VMNET_HELPER=1 USE_PCAP=0 \
	SDL_FRAMEWORK_PATH="`pwd`/Frameworks" REGENIE=${REGENIE} ARCHOPTS="-DAMPLE -target arm64-apple-macos11" \
	BUILDDIR=build-arm64 UNAME="Darwin arm64 arm" UNAME_M=arm64 UNAME_P=arm
	mv mame mame-arm64

mame-x64:
	make -j3 REGENIE=${REGENIE} SOURCES=${SOURCES} SDL_INI_PATH=. USE_VMNET_HELPER=1 USE_PCAP=0 \
	SDL_FRAMEWORK_PATH="`pwd`/Frameworks" REGENIE=${REGENIE} ARCHOPTS="-DAMPLE -target x86_64-apple-macos10.11" \
	BUILDDIR=build-x64 UNAME="Darwin x86_64 i386" UNAME_M=x86_64 UNAME_P=i386
	mv mame mame-x64



.PHONY: mame64d
mame64d:
	make -j2 SOURCES=${SOURCES} SDL_INI_PATH=. USE_VMNET_HELPER=1 USE_PCAP=0 SDL_FRAMEWORK_PATH="`pwd`/Frameworks" DEBUG=1 SYMBOLS=1 REGENIE=${REGENIE} ARCHOPTS=-DAMPLE
	install_name_tool -add_rpath ./Frameworks/ mame64d

#.PHONY: regenie
#regenie:
#	make -j2 SOURCES=${SOURCES} SDL_INI_PATH=. USE_VMNET_HELPER=1 USE_PCAP=0 SDL_FRAMEWORK_PATH="`pwd`/Frameworks" DEBUG=1 SYMBOLS=1 REGENIE=1


# excluding hashes directory for now.
HASH = apple1.xml \
	apple2_cass.xml apple2_flop_clcracked.xml apple2_flop_misc.xml apple2_flop_orig.xml \
	apple2gs_flop_misc.xml apple2gs_flop_orig.xml apple2gs_flop_clcracked.xml \
	apple3.xml cecflop.xml \
	mac_hdd.xml mac_flop.xml mac_hdflop.xml \
	softwarelist.dtd

mame-data.tgz:
	tar cfz mame-data.tgz --disable-copyfile \
	artwork bgfx ini keymaps language plugins samples uismall.bdf \
	$(addprefix hash/,$(HASH))

.PHONY: clean
clean:
	rm mame64
	rm mame-data.tgz
